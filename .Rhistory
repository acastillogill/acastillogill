> library(summarytools)
> library(leaflet)
> library(tmap)
> library(tmaptools)
> library(htmlwidgets)
> library(htmltools)
> library(lubridate)
> opts_chunk$set(echo = TRUE,
+                warning = FALSE,
+                error = FALSE,
+                message = FALSE,
+                collapse= TRUE,
+                comment = NA,
+                tidy = TRUE)
> theme_set(theme_light())
>
> options(
+   digits=3,
+   scipen = 999
+ )
>
> scale_colour_discrete <- function(...) scale_colour_brewer(..., palette="Paired")
> scale_fill_discrete <- function(...) scale_fill_brewer(... , palette="Paired")
>
> r_downloads <- readRDS(file=here::here("static","data","r-downloads.rds"))
>
> r_downloads <- na.omit(r_downloads)
> iso_codes <- read_csv(here::here("static","data","iso_countries.csv"))
Parsed with column specification:
cols(
name = col_character(),
iso = col_character(),
iso_3 = col_character(),
country_code = col_integer(),
region = col_character(),
sub_region = col_character()
)
> r_downloads%<>%
+   full_join(iso_codes, by=c("country"="iso"))%>%
+   filter(!is.na(sub_region))
>
> r_downloads%>%
+   #Group by the month of the year
+   group_by(month(date), sub_region)%>%
+   #Count downloads by the month of the year
+   summarise(monthly_downloads=n())%>%
+   #Pipe to make a plot
+   ggplot(aes(x=`month(date)`,y= monthly_downloads))+
+   #Add line
+   geom_line(alpha=0.5, color="purple")+
+   geom_point(color="purple")+
+ scale_x_continuous(breaks=c(seq(1,12,1)))+
+    #Add nice commas y axis
+ scale_y_continuous(labels=comma_format())+
+    #Add title
+   labs(title="Monthly R downloads around the world",
+        y="Downloads",
+        x="Week")+
+   facet_wrap(~sub_region, scales="free")
Warning message:
Removed 10 rows containing missing values (geom_point).
> x <-
+   c("dplyr",
+     "knitr",
+     "here",
+     "scales",
+     "magrittr",
+     "ggplot2",
+     "cowplot",
+     "tidyverse",
+     "Metrics",
+     "rsample",
+     "broom",
+     "sf",
+     "rgdal",
+     "summarytools",
+     "leaflet",
+     "tmap",
+     "tmaptools",
+     "lubridate")
>
> lapply(x, require, character.only = TRUE)
[[1]]
[1] TRUE
[[2]]
[1] TRUE
[[3]]
[1] TRUE
[[4]]
[1] TRUE
[[5]]
[1] TRUE
[[6]]
[1] TRUE
[[7]]
[1] TRUE
[[8]]
[1] TRUE
[[9]]
[1] TRUE
[[10]]
[1] TRUE
[[11]]
[1] TRUE
[[12]]
[1] TRUE
[[13]]
[1] TRUE
[[14]]
[1] TRUE
[[15]]
[1] TRUE
[[16]]
[1] TRUE
[[17]]
[1] TRUE
[[18]]
[1] TRUE
>
> opts_chunk$set(echo = TRUE,
+                warning = FALSE,
+                error = FALSE,
+                message = FALSE,
+                collapse= TRUE,
+                comment = NA,
+                tidy = TRUE)
>
> theme_set(theme_light())
>
> options(
+   digits=3,
+   scipen = 999
+ )
>
> theme_set(theme_light())
>
> scale_colour_discrete <- function(...) scale_colour_brewer(..., palette="Paired")
> scale_fill_discrete <- function(...) scale_fill_brewer(... , palette="Paired")
>
> r_downloads <- readRDS(file=here::here("static","data","r-downloads.rds"))
>
> x <-
+   c("dplyr",
+     "knitr",
+     "here",
+     "scales",
+     "magrittr",
+     "ggplot2",
+     "cowplot",
+     "tidyverse",
+     "Metrics",
+     "rsample",
+     "broom",
+     "sf",
+     "rgdal",
+     "summarytools",
+     "leaflet",
+     "tmap",
+     "tmaptools",
+     "lubridate")
>
> lapply(x, require, character.only = TRUE)
[[1]]
[1] TRUE
[[2]]
[1] TRUE
[[3]]
[1] TRUE
[[4]]
[1] TRUE
[[5]]
[1] TRUE
[[6]]
[1] TRUE
[[7]]
[1] TRUE
[[8]]
[1] TRUE
[[9]]
[1] TRUE
[[10]]
[1] TRUE
[[11]]
[1] TRUE
[[12]]
[1] TRUE
[[13]]
[1] TRUE
[[14]]
[1] TRUE
[[15]]
[1] TRUE
[[16]]
[1] TRUE
[[17]]
[1] TRUE
[[18]]
[1] TRUE
>
> opts_chunk$set(echo = TRUE,
+                warning = FALSE,
+                error = FALSE,
+                message = FALSE,
+                collapse= TRUE,
+                comment = NA,
+                tidy = TRUE)
>
> theme_set(theme_light())
>
> options(
+   digits=3,
+   scipen = 999
+ )
>
> theme_set(theme_light())
>
> scale_colour_discrete <- function(...) scale_colour_brewer(..., palette="Paired")
> scale_fill_discrete <- function(...) scale_fill_brewer(... , palette="Paired")
>
> r_downloads <- readRDS(file=here::here("static","data","r-downloads.rds"))
>
> r_downloads <- na.omit(r_downloads)
>
> r_downloads <- readRDS(file=here::here("static","data","r-downloads.rds"))
> View(r_downloads)
> x <-
+   c("dplyr",
+     "knitr",
+     "here",
+     "scales",
+     "magrittr",
+     "ggplot2",
+     "cowplot",
+     "tidyverse",
+     "Metrics",
+     "rsample",
+     "broom",
+     "sf",
+     "rgdal",
+     "summarytools",
+     "leaflet",
+     "tmap",
+     "tmaptools",
+     "lubridate")
>
> lapply(x, require, character.only = TRUE)
[[1]]
[1] TRUE
[[2]]
[1] TRUE
[[3]]
[1] TRUE
[[4]]
[1] TRUE
[[5]]
[1] TRUE
[[6]]
[1] TRUE
[[7]]
[1] TRUE
[[8]]
[1] TRUE
[[9]]
[1] TRUE
[[10]]
[1] TRUE
[[11]]
[1] TRUE
[[12]]
[1] TRUE
[[13]]
[1] TRUE
[[14]]
[1] TRUE
[[15]]
[1] TRUE
[[16]]
[1] TRUE
[[17]]
[1] TRUE
[[18]]
[1] TRUE
>
> opts_chunk$set(echo = TRUE,
+                warning = FALSE,
+                error = FALSE,
+                message = FALSE,
+                collapse= TRUE,
+                comment = NA,
+                tidy = TRUE)
>
> theme_set(theme_light())
>
> options(
+   digits=3,
+   scipen = 999
+ )
>
> theme_set(theme_light())
>
> scale_colour_discrete <- function(...) scale_colour_brewer(..., palette="Paired")
> scale_fill_discrete <- function(...) scale_fill_brewer(... , palette="Paired")
>
> r_downloads <- readRDS(file=here::here("static","data","r-downloads.rds"))
r_downloads <- readRDS(file=here::here("static","data","r-downloads.rds"))
View(r_downloads)
arrange(r_downloads, desc(date))
arrange(r_downloads, desc(date),desc(time))
arrange(r_downloads, date,time)
r_downloads <- na.omit(r_downloads)%>%
filter(date<"2018-10-20")
iso_codes <- read_csv(here::here("static","data","iso_countries.csv"))
r_downloads%<>%
full_join(iso_codes, by=c("country"="iso"))%>%
filter(!is.na(sub_region))
names(r_downloads)
r_downloads%>%
group_by(country)%>%
summarise(n=n())%>%
filter(!is.na(n))%>%
arrange(desc(n))->downloads_per_country
names(downloads_per_country)
downloads_per_country%>%
arrange(desc(n))%>%
head(10)%>%
mutate(name=fct_reorder(name,n))%>%
ggplot(aes(name,n,fill=name))+
geom_col()+
expand_limits(y=0)+
coord_flip()+
scale_y_continuous(labels=comma_format())+
labs(title="Top 10 countries by R downloads",
x="",
y="Downloads")+
theme(legend.position = "none")
downloads_per_country%>%
arrange(desc(n))%>%
head(10)%>%
mutate(country=fct_reorder(country,n))%>%
ggplot(aes(country,n,fill=country))+
geom_col()+
expand_limits(y=0)+
coord_flip()+
scale_y_continuous(labels=comma_format())+
labs(title="Top 10 countries by R downloads",
x="",
y="Downloads")+
theme(legend.position = "none")
names(r_downloads)
head(r_downloads)
downloads_per_country%>%
arrange(desc(n))%>%
head(10)%>%
mutate(name=fct_reorder(name,n))%>%
ggplot(aes(name,n,fill=name))+
geom_col()+
expand_limits(y=0)+
coord_flip()+
scale_y_continuous(labels=comma_format())+
labs(title="Top 10 countries by R downloads",
x="",
y="Downloads")+
theme(legend.position = "none")
r_downloads%>%
group_by(name)%>%
summarise(n=n())%>%
filter(!is.na(n))%>%
arrange(desc(n))->downloads_per_country
downloads_per_country%>%
arrange(desc(n))%>%
head(10)%>%
mutate(name=fct_reorder(name,n))%>%
ggplot(aes(name,n,fill=name))+
geom_col()+
expand_limits(y=0)+
coord_flip()+
scale_y_continuous(labels=comma_format())+
labs(title="Top 10 countries by R downloads",
x="",
y="Downloads")+
theme(legend.position = "none")
blogdown::serve_site()
iso_codes <- read_csv(here::here("static","data","iso_countries.csv"))
pop <-read_csv(here::here("static","data","country_populations.csv"))
iso_codes <- read_csv(here::here("static","data","iso_countries.csv"))
pop <-read_csv(here::here("static","data","country_populations.csv"))
map_path <- here::here("static","data","world_shapefile","world_shapefile.shp")
world <- sf::st_read(map_path)
world_full <- world%>%
left_join(full_maps, by=c("ISO3"="iso_3"))
world_full <- world%>%
left_join(full_maps, by=c("ISO3"="iso_3"))
full_maps <- downloads_per_country%>%
left_join(pop, by=c("name"="name"))%>%
select(country, n, name, iso_3, region, sub_region, pop_2018)%>%
mutate(n_capita=n/pop_2018)%>%
filter(!is.na(n_capita),
pop_2018!=0)
names(pop)
names(downloads_per_country)
names(r_downloads)
full_maps <- r_downloads%>%
left_join(pop, by=c("name"="name"))%>%
select(country, n, name, iso_3, region, sub_region, pop_2018)%>%
mutate(n_capita=n/pop_2018)%>%
filter(!is.na(n_capita),
pop_2018!=0)
names(downloads_per_country)
downloads_per_country%>%
left_join(pop, by=c("name"="name")
names(iso_codes)
names(pop)
full_maps <- downloads_per_country%>%
full_join(iso_codes, by=c("name"="name"))%>%
filter(!is.na(sub_region))%>%
left_join(pop, by=c("name"="name"))%>%
select(country, n, name, iso_3, region, sub_region, pop_2018)%>%
mutate(n_capita=n/pop_2018)%>%
filter(!is.na(n_capita),
pop_2018!=0)
# Chunk 1: setup
x <-
c("dplyr",
"knitr",
"here",
"scales",
"magrittr",
"ggplot2",
"cowplot",
"tidyverse",
"Metrics",
"rsample",
"broom",
"sf",
"rgdal",
"summarytools",
"leaflet",
"tmap",
"tmaptools",
"lubridate")
lapply(x, require, character.only = TRUE)
opts_chunk$set(echo = FALSE,
warning = FALSE,
error = FALSE,
message = FALSE,
collapse= TRUE,
comment = NA,
tidy = TRUE)
theme_set(theme_light())
options(
digits=3,
scipen = 999
)
knit_hooks$set(inline = function(x) {
prettyNum(round(x,2), big.mark=",")
})
scale_colour_discrete <- function(...) scale_colour_brewer(..., palette="Paired")
scale_fill_discrete <- function(...) scale_fill_brewer(... , palette="Paired")
r_downloads <- readRDS(file=here::here("static","data","r-downloads.rds"))
r_downloads <- na.omit(r_downloads)%>%
filter(date<"2018-10-20")
# Chunk 2: read-country-codes-and-pop-and-map
iso_codes <- read_csv(here::here("static","data","iso_countries.csv"))
pop <-read_csv(here::here("static","data","country_populations.csv"))
map_path <- here::here("static","data","world_shapefile","world_shapefile.shp")
world <- sf::st_read(map_path)
# Chunk 3: merge-country-codes
r_downloads%<>%
full_join(iso_codes, by=c("country"="iso"))%>%
filter(!is.na(sub_region))
# Chunk 4: downloads-by-country
r_downloads%>%
group_by(name)%>%
summarise(n=n())%>%
filter(!is.na(n))%>%
arrange(desc(n))->downloads_per_country
# Chunk 5: plot-top-10-countries
downloads_per_country%>%
arrange(desc(n))%>%
head(10)%>%
mutate(name=fct_reorder(name,n))%>%
ggplot(aes(name,n,fill=name))+
geom_col()+
expand_limits(y=0)+
coord_flip()+
scale_y_continuous(labels=comma_format())+
labs(title="Top 10 countries by R downloads in 2017/18",
x="",
y="Downloads")+
theme(legend.position = "none")
full_maps <- downloads_per_country%>%
full_join(iso_codes, by=c("name"="name"))%>%
filter(!is.na(sub_region))%>%
left_join(pop, by=c("name"="name"))%>%
select(n, name, iso_3, region, sub_region, pop_2018)%>%
mutate(n_capita=n/pop_2018)%>%
filter(!is.na(n_capita),
pop_2018!=0)
world_full <- world%>%
left_join(full_maps, by=c("ISO3"="iso_3"))
names(full_maps)
names(world)
world_full <- world%>%
left_join(full_maps, by=c("ISO3"="iso_3"))
n_map <- tm_shape(world_full) +
tm_borders(col="black", lwd=0.1)+
tm_fill(col="n",n=4, style="jenks", palette = get_brewer_pal("BuPu", n = 4, contrast = c(0.13, 0.9))) +
tm_layout(main.title = "Total R downloads in 2017/18",
main.title.size = 2, frame = TRUE, bg.color = "aliceblue", title.position = c("right","bottom"))+
tm_legend(position=c("left", "bottom"), bg.color="white", frame=TRUE, legend.title.size=1)
n_map
blogdown::hugo_version()
