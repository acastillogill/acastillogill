---
title: Clustering Kiva loans
author: √Ångela D. Castillo-Gill
date: '2018-08-09'
slug: clustering-kiva-loans
categories:
  - R
  - EDA
tags: 
  - Kaggle
  - Kiva
draft: TRUE
summary: What are the main types of Kiva loan groups?
output:
  blogdown::html_page:
    toc: true
    number_sections: true
    toc_depth: 2
  fig_caption: true
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
x <-
  c("tidyverse",
    "knitr",
    "formatR",
    "stringr",
    "quantmode",
    "skimr",
    "lubridate",
    "tidyr",
    "formattable",
    "grid",
    "gridExtra",
    "kableExtra",
    "here",
    "dummies",
    "cluster",
    "data.table")

lapply(x, require, character.only = TRUE)


opts_chunk$set(echo = FALSE,
               warning = FALSE,
               error = FALSE,
               message = FALSE,
               collapse= TRUE,
               comment = NA,
               tidy = TRUE)
```

# Summary



# Purpose of this post

 

# The data

The dataset I'll be using is the Kaggle dataset [UK Accidents 10 years history with many variables](https://www.kaggle.com/benoit72/uk-accidents-10-years-history-with-many-variables). T

```{r results='hide', message=FALSE}
path <- "/Volumes/TOSHIBAEXT/RStudio/blog/content/post/accidents/"
accidents <- read_csv(paste0(path,"Accidents0514.csv"))
vehicles <- read_csv(paste0(path,"Vehicles0514.csv"))
```

```{r}
#Look at dataset
str(vehicles, give.attr=FALSE)
```

```{r}
#Maximum date

```




```{r results='hide'}

```

# Data cleaning 

```{r}

```


Since I will the k-means algorithm, I need all my variables to be numerical. I have several important categorical variables. To give them a numerical value, I will dummify them. To what? To make an additional column for each category level (example: Asia, Africa, South America, and Oceania) and then assign them a value of 1 or 0 depending on the category they belong to. An observation that belongs to Asia, would have a 1 in the asia column and a 0 in the rest. 

```{r}
#Remove variables that won't be used
kiva_loans_dummy <- kiva_loans%>%
  dplyr::select(-id,
         -country_code,
         -posted_time,
         -funded_time,
         -disbursed_time)

kiva_loans_dummy <- as.data.frame(kiva_loans_dummy)
  
#Make data frame with dummies
kiva_loans_clust <- dummy.data.frame(kiva_loans_dummy)
```

I need to make sure that the variables are on similar scales. That is not the case. Using the `scale()` I will scale each feature so that it has mean 0 and standard deviation of 1. 

```{r results='hide'}
#Scale all variables
kiva_loans_scale <- kiva_loans_clust%>%
  mutate_all(funs(scale))
```

```{r results='hide'}
#Examine structure of scaled data
str(kiva_loans_scale, give.attr=FALSE)
```

```{r}
#Select small sample
sample <- kiva_loans_clust[sample(nrow(kiva_loans_clust),1000),]

```

# Clustering

```{r results='hide'}
#Create distance matrix

g.dist <- daisy(sample, metric = "euclidean", type = list(symm=2))

```

```{r}
hc.m = hclust(g.dist, method="median")
hc.s = hclust(g.dist, method="single")
hc.c = hclust(g.dist, method="complete")
  layout(matrix(1:3, nrow=1))
  plot(hc.m)
  plot(hc.s)
  plot(hc.c)
```

```{r}
table(cutree(hc.c, k=5))
```


# Techniques used


# Questions from this analysis


