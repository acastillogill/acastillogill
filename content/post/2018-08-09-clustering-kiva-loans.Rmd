---
title: Exploring Kiva loans
author: √Ångela D. Castillo-Gill
date: '2018-07-07'
slug: exploring-kiva-loans
categories:
  - R
  - EDA
tags: 
  - Kaggle
  - Kiva
summary: What do Kiva loans around the world look like?
output:
  blogdown::html_page:
    toc: true
    number_sections: true
    toc_depth: 2
  fig_caption: true
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
x <-
  c("tidyverse",
    "knitr",
    "formatR",
    "stringr",
    "quantmode",
    "skimr",
    "lubridate",
    "tidyr",
    "formattable",
    "grid",
    "gridExtra",
    "kableExtra",
    "here",
    "dummies")

lapply(x, require, character.only = TRUE)


opts_chunk$set(echo = FALSE,
               warning = FALSE,
               error = FALSE,
               message = FALSE,
               collapse= TRUE,
               comment = NA,
               tidy = TRUE)
```

# Summary



# Purpose of this post

While looking at the distributions for variables like loan amounts `loan_usd` or loan term `term_in_months`, I realised that there are many types of loans represented in that plot. Therefore, I thought it would be interesting to cluster the data. To what? To divide the large dataset into groups that share similar characteristics.  

# The data

The dataset I'll be using is the one I cleaned and used for the exploratory data analysis in the [previous post.](https://www.ad-castillogill.com/post/exploring-kiva-loans/)

```{r}
#Load previously saved data
path <- "/Volumes/TOSHIBAEXT/RStudio/blog/content/post/kiva_data/"
kiva_loans <- readRDS(paste0(path,"kiva_loans.rds"))
```

The cleaned dataset has 568,943 observations and 15 variables.

```{r results='hide'}
#Get a glimpse of kiva_loans
glimpse(kiva_loans)
```

# Data cleaning 

For the technique I'll be using, I need to have a clean dataset. For that I will remove all missing values. After using the `summary()` function, I see that most missing values are in the `giving_time_num` and `funded_time` which are variables that I created to see specific intervals between requesting the loan and it being funded. 

```{r}
#Remove missing values
kiva_loans <- na.omit(kiva_loans)
```

Since I will the k-means algorithm, I need all my variables to be numerical. I have several important categorical variables. To give them a numerical value, I will dummify them. To what? To make an additional column for each category level (example: Asia, Africa, South America, and Oceania) and then assign them a value of 1 or 0 depending on the category they belong to. An observation that belongs to Asia, would have a 1 in the asia column and a 0 in the rest. 

```{r}
#Remove variables that won't be used
kiva_loans_dummy <- kiva_loans%>%
  dplyr::select(-id,
         -country_code,
         -posted_time,
         -funded_time,
         -disbursed_time)

kiva_loans_dummy <- as.data.frame(kiva_loans_dummy)
  
#Make data frame with dummies
kiva_loans_clust <- dummy.data.frame(kiva_loans_dummy)
```

I need to make sure that the variables are on similar scales. That is not the case. Using the `scale()` I will scale each feature so that it has mean 0 and standard deviation of 1. 

```{r}
#Scale all variables
kiva_loans_scale <- kiva_loans_clust%>%
  mutate_all(funs(scale))
```

```{r}
#Examine structure of scaled data
str(kiva_loans_scale, give.attr=FALSE)
```

```{r}
#Select small sample
sample <- kiva_loans_scale[sample(nrow(kiva_loans_scale),100),]

```

# Clustering

```{r}
#Create distance matrix
dist(sample, method="euclidean")
```



# Techniques used


# Questions from this analysis


