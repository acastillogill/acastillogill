---
title: "Linear regression: who tends to download R software"
author: √Ångela Castillo-Gill
date: '2018-12-01'
slug: linear-regression-r-downloads
categories: []
tags: 
  - Kaggle
  - Tidy Tuesday
  - EDA
  - Maps
description: "In this blog post, I set out to explain the relationship between the education index and R downloads per capita across the globe. To do this, I identified an education based metric for all countries. I then regressed R downloads per capita onto the education index. I found that the education index (values from 2016) explains about 64.6% of variation in R downloads per capita. There were several outliers including Turkmenistan, Tajikistan, Libya, Burkina Faso, and Chad."
banner: "banners/edu_index_downloads_capita.png"
images: ["banners/edu_index_downloads_capita.png"]
draft: FALSE
header: 
  image: "banners/edu_index_downloads_capita.png"
  caption: ""
output:
  blogdown::html_page:
    toc: true
    number_sections: true
    toc_depth: 2
  fig_caption: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}

#Load packages
x <-
  c("knitr",
    "here",
    "tidyverse",
    "RColorBrewer",
    "hrbrthemes",
    "devtools",
    "roxygen2",
    "ggrepel",
    "gridExtra")


lapply(x, require, character.only = TRUE)


opts_chunk$set(echo = FALSE,
               warning = FALSE,
               error = FALSE,
               message = FALSE,
               collapse = TRUE,
               comment = NA,
               tidy = TRUE,
               include = TRUE)
             # fig.width = 25,
            #  out.extra='angle=90',
            #  fig.align='center',
          #    fig.asp=0.5,
           #   fig.crop=FALSE)

#Set theme
theme_set(theme_ipsum_rc())

#Set number of digits
options(
  digits=4,
  scipen = 999
)

#Set number of inline digits
knit_hooks$set(inline = function(x) {
  prettyNum(round(x,4), big.mark=",")
})

extrafont::loadfonts()
```












```{r where-am-i}
#Where am I?
here::here()
```

```{r read-data}
# Read data
NBA <- read_csv(here::here("static","data","free_throws.csv"))
```
















```{r assign-correct-variable-type}
#Assign factor columns to a vector factors

factors <- c("end_result",
             "game",
             "game_id",
             "play",
             "player",
             "playoffs",
             "score",
             "season")

#Assign factor type to factors
NBA[factors] <- lapply(NBA[factors], factor)
```

```{r NBA-regular-vs-playoffs}
NBA_reg <- NBA%>%
  filter(playoffs=="regular")
NBA_play <- NBA%>%
  filter(playoffs=="playoffs")
```


```{r stats-all-time}
all_NBA_reg <- NBA_reg%>%
  group_by(player)%>%
  summarise(shots_attempts_ratio=sum(shot_made)/n(),
            total_attempts=n(),
            shots=sum(shot_made))%>%
  arrange(desc(shots))%>%
  head(10)

all_NBA_play <- NBA_play%>%
  group_by(player)%>%
  summarise(shots_attempts_ratio=sum(shot_made)/n(),
            total_attempts=n(),
            shots=sum(shot_made))%>%
  arrange(desc(shots))%>%
  head(10)

```

```{r stats-per-season}
season_NBA_reg <- NBA_reg%>%
  group_by(season)%>%
  nest() %>%
  mutate(data = map(data, ~ .x %>%
        group_by(player)%>%
        summarise(shots_attempts_ratio=sum(shot_made)/n(),
        total_attempts=n(),
        shots=sum(shot_made))%>%
        arrange(desc(shots))%>%
        top_n(1)
        )) %>%
 unnest


season_NBA_play <- NBA_play%>%
  group_by(season)%>%
  nest() %>%
  mutate(data = map(data, ~ .x %>%
        group_by(player)%>%
        summarise(shots_attempts_ratio=sum(shot_made)/n(),
        total_attempts=n(),
        shots=sum(shot_made))%>%
        arrange(desc(shots))%>%
        top_n(1)
        )) %>%
 unnest


```



```{r all-time-ratio-col}
blues <- brewer.pal(9,"Blues")
blue_range <- colorRampPalette(blues)

reds <- brewer.pal(9,"Reds")
red_range <- colorRampPalette(reds)

best_players_plot_ratio_reg <- all_NBA_reg%>%
  mutate(player=fct_reorder(player, shots_attempts_ratio))%>%
  ggplot(aes(x=player,y=shots_attempts_ratio))+
  geom_col(fill=blue_range(10))+
  coord_flip()+
  labs(title="Shots per free throws, top ten players (2006/16)",
       subtitle = "Regular season, players ranked by total shots.",
       x="",
       y="Shots per free throws")+
  theme(text = element_text(size=30))+
  scale_y_comma(labels = scales::percent_format())


best_players_plot_ratio_play <- all_NBA_play%>%
  mutate(player=fct_reorder(player, shots_attempts_ratio))%>%
  ggplot(aes(x=player,y=shots_attempts_ratio))+
  geom_col(fill=red_range(10))+
  coord_flip()+
  labs(title="Shots per free throws, top ten players (2006/16)",
       subtitle = "Playoffs season, players ranked by total shots.",
       x="",
       y="Shots per free throws")+
  theme(text = element_text(size=30))+
  scale_y_comma(labels = scales::percent_format())

all_time_ratio <- arrangeGrob(best_players_plot_ratio_reg,
                           best_players_plot_ratio_play,
                           nrow=1)

ggsave("all_time_ratio.png",all_time_ratio,width = 14,height=5,limitsize = FALSE,bg="white")
```

```{r all-time-shots-col}
all_time_shots_reg <- all_NBA_reg%>%
  mutate(player=fct_reorder(player, shots))%>%
  ggplot(aes(x=player,y=shots))+
  geom_col(fill=blue_range(10))+
  coord_flip()+
  labs(
       title="Total shots, top ten players (2006/16)",
       subtitle = "Regular season, players ranked by total shots.",
       x="",
       y="Total shots")

all_time_shots_play  <- all_NBA_play%>%
  mutate(player=fct_reorder(player, shots))%>%
  ggplot(aes(x=player,y=shots))+
  geom_col(fill=red_range(10))+
  coord_flip()+
  labs(
      title="Total shots, top ten players (2006/16)",
       subtitle = "Playoffs season, players ranked by total shots.",
       x="",
       y="Total shots")

all_time_shots <- arrangeGrob(all_time_shots_reg,
                           all_time_shots_play,
                           nrow=1)

ggsave("all_time_shots.png",all_time_shots,width = 14,height=5,limitsize = FALSE,bg="white")
```




```{r season-ratios-point}

season_players_plot_ratio_reg <- season_NBA_reg%>%
  ggplot(aes(x=season,y=shots_attempts_ratio))+
  geom_point(size=5, color="Blue", alpha=0.3)+
  labs(title="Shots per free throws, top annual players (2006/16)",
       subtitle = "Regular season, players ranked by total shots.",
       x="",
       y="Shots per free throws")+
  geom_text_repel(aes(label=player), force=10, size=3, segment.alpha = 0.5)+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_comma(labels = scales::percent_format())+
  expand_limits(y=c(0.7,0.95))

season_players_plot_ratio_play <- season_NBA_play%>%
  ggplot(aes(x=season,y=shots_attempts_ratio))+
  geom_point(size=5, color="red", alpha=0.3)+
  labs(title="Shots per free throws, top annual players (2006/16)",
       subtitle = "Playoffs season, players ranked by total shots.",
       x="",
       y="Shots per free throws")+
  geom_text_repel(aes(label=player), force=10, size=3, segment.alpha = 0.5)+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_comma(labels = scales::percent_format())+
  expand_limits(y=c(0.7,0.95))


season_ratios <- arrangeGrob(season_players_plot_ratio_reg,
                           season_players_plot_ratio_play,
                           nrow=1)

ggsave("season_ratios.png",season_ratios,width = 14,height=5,limitsize = FALSE,bg="white")
```


```{r season-shots-point}

season_players_plot_shots_reg <-  season_NBA_reg%>%
  ggplot(aes(x=season,y=shots))+
  geom_point(size=5, color="Blue", alpha=0.3)+
  labs(title="Total shots, top annual players (2006/16)",
       subtitle = "Regular season, players ranked by total shots.",
       x="",
       y="Total shots") +
  geom_text_repel(aes(label=player), force=10, size=3, segment.alpha = 0.5)+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  expand_limits(y=400)

season_players_plot_shots_play <-  season_NBA_play%>%
  ggplot(aes(x=season,y=shots))+
  geom_point(size=5, color="Red", alpha=0.3)+
  labs(title="Total shots, top annual players (2006/16)",
       subtitle = "Playoffs season, players ranked by total shots.",
       x="",
       y="Total shots") +
  geom_text_repel(aes(label=player), force=10, size=3, segment.alpha = 0.5)+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  expand_limits(y=120)


season_shots <- arrangeGrob(season_players_plot_shots_reg,
                           season_players_plot_shots_play,
                           nrow=1)

ggsave("season_shots.png",season_shots,width = 14,height=5,limitsize = FALSE,bg="white")
```


```{r final-grobs}

season <- arrangeGrob(season_shots, season_ratios, nrow=2)

ggsave("season.png",season,width = 14,height=10,limitsize = FALSE,bg="white")


all_time <- arrangeGrob(all_time_shots, all_time_ratio, nrow=2)

ggsave("all_time.png",all_time,width = 14,height=10,limitsize = FALSE,bg="white")
```
