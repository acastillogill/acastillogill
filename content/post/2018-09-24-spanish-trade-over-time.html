---
title: Spanish trade over time
author: Ángela D. Castillo-Gill
date: '2018-09-24'
slug: spanish-trade-over-time
categories:
  - R
  - EDA
tags: 
  - Kaggle
  - Kiva
summary: What and from where does Spain import?
output:
  blogdown::html_page:
    toc: true
    number_sections: true
    toc_depth: 2
  fig_caption: true
editor_options: 
  chunk_output_type: console
---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>

<div id="TOC">
<ul>
<li><a href="#summary"><span class="toc-section-number">1</span> Summary</a></li>
<li><a href="#purpose-of-this-post"><span class="toc-section-number">2</span> Purpose of this post</a></li>
<li><a href="#the-data"><span class="toc-section-number">3</span> The data</a></li>
<li><a href="#data-cleaning"><span class="toc-section-number">4</span> Data cleaning</a></li>
<li><a href="#exploratory-data-analysis"><span class="toc-section-number">5</span> Exploratory data analysis</a></li>
<li><a href="#techniques-used"><span class="toc-section-number">6</span> Techniques used</a></li>
<li><a href="#questions-from-this-analysis"><span class="toc-section-number">7</span> Questions from this analysis</a></li>
</ul>
</div>

<div id="summary" class="section level1">
<h1><span class="header-section-number">1</span> Summary</h1>
<p><em>To see the code used in this post, visit my <a href="https://www.kaggle.com/adcastillogill/exploring-kiva-loans">kernel on kaggle in R Markdown format</a>.</em></p>
</div>
<div id="purpose-of-this-post" class="section level1">
<h1><span class="header-section-number">2</span> Purpose of this post</h1>
</div>
<div id="the-data" class="section level1">
<h1><span class="header-section-number">3</span> The data</h1>
<pre><code>Observations: 671,205
Variables: 20
$ id                 &lt;int&gt; 653051, 653053, 653068, 653063, 653084, 108...
$ funded_amount      &lt;dbl&gt; 300, 575, 150, 200, 400, 250, 200, 400, 475...
$ loan_amount        &lt;dbl&gt; 300, 575, 150, 200, 400, 250, 200, 400, 475...
$ activity           &lt;chr&gt; &quot;Fruits &amp; Vegetables&quot;, &quot;Rickshaw&quot;, &quot;Transpo...
$ sector             &lt;chr&gt; &quot;Food&quot;, &quot;Transportation&quot;, &quot;Transportation&quot;,...
$ use                &lt;chr&gt; &quot;To buy seasonal, fresh fruits to sell.&quot;, &quot;...
$ country_code       &lt;chr&gt; &quot;PK&quot;, &quot;PK&quot;, &quot;IN&quot;, &quot;PK&quot;, &quot;PK&quot;, &quot;KE&quot;, &quot;IN&quot;, &quot;...
$ country            &lt;chr&gt; &quot;Pakistan&quot;, &quot;Pakistan&quot;, &quot;India&quot;, &quot;Pakistan&quot;...
$ region             &lt;chr&gt; &quot;Lahore&quot;, &quot;Lahore&quot;, &quot;Maynaguri&quot;, &quot;Lahore&quot;, ...
$ currency           &lt;chr&gt; &quot;PKR&quot;, &quot;PKR&quot;, &quot;INR&quot;, &quot;PKR&quot;, &quot;PKR&quot;, &quot;KES&quot;, &quot;...
$ partner_id         &lt;dbl&gt; 247, 247, 334, 247, 245, NA, 334, 245, 245,...
$ posted_time        &lt;dttm&gt; 2014-01-01 06:12:39, 2014-01-01 06:51:08, ...
$ disbursed_time     &lt;dttm&gt; 2013-12-17 08:00:00, 2013-12-17 08:00:00, ...
$ funded_time        &lt;dttm&gt; 2014-01-02 10:06:32, 2014-01-02 09:17:23, ...
$ term_in_months     &lt;dbl&gt; 12, 11, 43, 11, 14, 4, 43, 14, 14, 11, 11, ...
$ lender_count       &lt;int&gt; 12, 14, 6, 8, 16, 6, 8, 8, 19, 24, 3, 16, 1...
$ tags               &lt;chr&gt; NA, NA, &quot;user_favorite, user_favorite&quot;, NA,...
$ borrower_genders   &lt;chr&gt; &quot;female&quot;, &quot;female, female&quot;, &quot;female&quot;, &quot;fema...
$ repayment_interval &lt;chr&gt; &quot;irregular&quot;, &quot;irregular&quot;, &quot;bullet&quot;, &quot;irregu...
$ date               &lt;date&gt; 2014-01-01, 2014-01-01, 2014-01-01, 2014-0...</code></pre>
<p>Some of the codebook came with the dataset and some I researched to make assumptions:</p>
<ul>
<li><code>funded_amount</code>: “The amount disbursed by Kiva to the field agent(USD)”</li>
</ul>
</div>
<div id="data-cleaning" class="section level1">
<h1><span class="header-section-number">4</span> Data cleaning</h1>
<p>From at the structure of our data, we can soon see there are a few bits that don’t make sense and need to be fixed.</p>
<p><strong>a. Missing values</strong></p>
<p>We will leave missing values in for now.</p>
<p><strong>b.<code>borrower_genders</code></strong></p>
<p>From the variable descriptions, we expected <code>borrower_genders</code>to have only two levels, <code>male</code>or <code>female</code>. Here we see many more levels, 11,298 to be precise. This isn’t very clear so we’ll fix that first by creating five levels:</p>
<pre><code>[1] &quot;mixed_genders&quot; &quot;mult_females&quot;  &quot;mult_males&quot;    &quot;single_female&quot;
[5] &quot;single_male&quot;  </code></pre>
<p><strong>c.<code>loan_amounts</code></strong></p>
<p>Now, since we’re trying to make sense of all loans, it’s better if <code>loan_amounts</code> is in the same currency. Let’s translate it to USD.</p>
<p><strong>d.<code>country_codes</code></strong></p>
<p>Finally, with 86 countries, we have 86 levels. Perhaps it would be interesting to create another category called continent to produce less levels and have a better understanding of the overall function of regional distributions.</p>
<p>Our country codes are in the ISO3166 format, so we will use the associated continent code found <a href="https://dev.maxmind.com/geoip/legacy/codes/country_continent/">here</a>. And make five continents. Africa, Asia, Europe, Oceania, and South America.</p>
<pre><code>[1] &quot;AF&quot; &quot;AS&quot; &quot;EU&quot; &quot;OC&quot; &quot;SA&quot;</code></pre>
<p><strong>e. Dates</strong></p>
<p>Let’s calculate two lengths of time that I think are interesting. First, how much time passes from the moment the loan is posted to the moment it’s disbursed (<code>total_time</code>). Second, how long does a loan take to get funded (<code>giving_time</code>)?</p>
</div>
<div id="exploratory-data-analysis" class="section level1">
<h1><span class="header-section-number">5</span> Exploratory data analysis</h1>
<p>Now, let’s describe the data starting with some plots and tables to understand it.</p>
<div class="figure"><span id="fig:continent-and-borrower-genders-plots"></span>
<img src="/post/2018-09-24-spanish-trade-over-time_files/figure-html/continent-and-borrower-genders-plots-1.png" alt="Four continents in descending order from the continent that requests the most loans (Asia). Notice Europe and North America do not appear. `mult_females` or `mult_males` means more than one female or male." width="960" />
<p class="caption">
Figure 5.1: Four continents in descending order from the continent that requests the most loans (Asia). Notice Europe and North America do not appear. <code>mult_females</code> or <code>mult_males</code> means more than one female or male.
</p>
</div>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:borrower-genders-table">Table 5.1: </span>A single female is the most common type of borrower gender with over half of all Kiva loans requested.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Gender
</th>
<th style="text-align:right;">
Percentage
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
single_female
</td>
<td style="text-align:right;">
65.82
</td>
</tr>
<tr>
<td style="text-align:left;">
single_male
</td>
<td style="text-align:right;">
17.43
</td>
</tr>
<tr>
<td style="text-align:left;">
mult_females
</td>
<td style="text-align:right;">
9.58
</td>
</tr>
<tr>
<td style="text-align:left;">
mixed_genders
</td>
<td style="text-align:right;">
6.58
</td>
</tr>
<tr>
<td style="text-align:left;">
mult_males
</td>
<td style="text-align:right;">
0.59
</td>
</tr>
</tbody>
</table>
<p>In all continents, single females request the most loans followed by single males. In Asia and South America, the third category is multiple females while in Africa it’s mixed genders.</p>
<div class="figure"><span id="fig:repayment-interval-and-continent"></span>
<img src="/post/2018-09-24-spanish-trade-over-time_files/figure-html/repayment-interval-and-continent-1.png" alt="In Asia and Oceania, the most popular repayment interval is irregular while in Africa and South America it's monthly." width="960" />
<p class="caption">
Figure 5.2: In Asia and Oceania, the most popular repayment interval is irregular while in Africa and South America it’s monthly.
</p>
</div>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:repayment-interval-table">Table 5.2: </span>The most popular type of repayment interval is monthly.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Repayment interval
</th>
<th style="text-align:right;">
Percentage
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
monthly
</td>
<td style="text-align:right;">
47
</td>
</tr>
<tr>
<td style="text-align:left;">
irregular
</td>
<td style="text-align:right;">
43
</td>
</tr>
<tr>
<td style="text-align:left;">
bullet
</td>
<td style="text-align:right;">
10
</td>
</tr>
</tbody>
</table>
<div class="figure"><span id="fig:sectors-and-continents"></span>
<img src="/post/2018-09-24-spanish-trade-over-time_files/figure-html/sectors-and-continents-1.png" alt="In every continent, the three most popular sectors are agriculture, retail, and food." width="960" />
<p class="caption">
Figure 5.3: In every continent, the three most popular sectors are agriculture, retail, and food.
</p>
</div>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:sector-table">Table 5.3: </span>Generally, the most frequent use of loans is agriculture, followed by food and retail.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Sector
</th>
<th style="text-align:right;">
Percentage
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Agriculture
</td>
<td style="text-align:right;">
27.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Food
</td>
<td style="text-align:right;">
20.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Retail
</td>
<td style="text-align:right;">
19.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Services
</td>
<td style="text-align:right;">
6.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Personal Use
</td>
<td style="text-align:right;">
5.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Education
</td>
<td style="text-align:right;">
5.1
</td>
</tr>
<tr>
<td style="text-align:left;">
Clothing
</td>
<td style="text-align:right;">
4.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Housing
</td>
<td style="text-align:right;">
4.1
</td>
</tr>
<tr>
<td style="text-align:left;">
Transportation
</td>
<td style="text-align:right;">
2.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Arts
</td>
<td style="text-align:right;">
1.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Health
</td>
<td style="text-align:right;">
1.2
</td>
</tr>
</tbody>
</table>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:continent-table">Table 5.4: </span>Half of all Kiva loans are requested in Asia followed by Africa, South America, Oceania and finally the European Union.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Continents
</th>
<th style="text-align:right;">
Percentage
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
AS
</td>
<td style="text-align:right;">
55.4
</td>
</tr>
<tr>
<td style="text-align:left;">
AF
</td>
<td style="text-align:right;">
29.8
</td>
</tr>
<tr>
<td style="text-align:left;">
SA
</td>
<td style="text-align:right;">
13.5
</td>
</tr>
<tr>
<td style="text-align:left;">
OC
</td>
<td style="text-align:right;">
1.4
</td>
</tr>
</tbody>
</table>
<p>Notice most loans are requested by single females, the least amount of loans are given in the EU, weekly repayment is an unpopular form of paying loans back and entertainment, wholesale, manufacturing, and construction amount less than 2.2% of sectors.</p>
<div class="figure"><span id="fig:countries-plot"></span>
<img src="/post/2018-09-24-spanish-trade-over-time_files/figure-html/countries-plot-1.png" alt="Philippines requests the mosts loans with over double as the second country, Kenya `KE`. Other top countries in this ranking are Cambodia `KH`, Pakistan `PK`, Peru `PE`, Colombia `CO`, Uganda `UG`, Tajikistan `TJ`, Ecuador `EC`, and Paraguay `PY`." width="768" />
<p class="caption">
Figure 5.4: Philippines requests the mosts loans with over double as the second country, Kenya <code>KE</code>. Other top countries in this ranking are Cambodia <code>KH</code>, Pakistan <code>PK</code>, Peru <code>PE</code>, Colombia <code>CO</code>, Uganda <code>UG</code>, Tajikistan <code>TJ</code>, Ecuador <code>EC</code>, and Paraguay <code>PY</code>.
</p>
</div>
<p>Now I’m curious to look at the top 10 countries requesting Kiva loans but per capita and per number of internet users.</p>
<div class="figure"><span id="fig:countries-plot-capita"></span>
<img src="/post/2018-09-24-spanish-trade-over-time_files/figure-html/countries-plot-capita-1.png" alt="Interesting to see how the ranking changed! The island of Samoa `WS` is leading, followed by Armenia `AM`. Countries that remain in the top 10 are Cambodia `KH`, Philippines `PH`, Kenya `KE`, and Tajikstan `TJ`. Other new countries are Timor-Leste `TL`, Paraguay `PY`, Palestine `PS`, and Lebanon `LB`." width="672" />
<p class="caption">
Figure 5.5: Interesting to see how the ranking changed! The island of Samoa <code>WS</code> is leading, followed by Armenia <code>AM</code>. Countries that remain in the top 10 are Cambodia <code>KH</code>, Philippines <code>PH</code>, Kenya <code>KE</code>, and Tajikstan <code>TJ</code>. Other new countries are Timor-Leste <code>TL</code>, Paraguay <code>PY</code>, Palestine <code>PS</code>, and Lebanon <code>LB</code>.
</p>
</div>
<p>Let’s see how the top 10 changes when it comes to internet users. I used the ranking based on numbers published by the International Telecommunications Union available <a href="https://en.wikipedia.org/wiki/List_of_countries_by_number_of_Internet_users">here</a>.</p>
<div class="figure"><span id="fig:countries-plot-users"></span>
<img src="/post/2018-09-24-spanish-trade-over-time_files/figure-html/countries-plot-users-1.png" alt="Interesting to see how the ranking changed! Leading the charts is the island of Samoa, followed by Armenia. Countries that remain in the top 10 are Cambodia `KH`, Philippines `PH`, Kenya `KE`, and Tajikstan `TJ`. Other new countries are Timor-Leste `TL`, Paraguay `PY`, Palestine `PS`, and Lebanon `LB`." width="672" />
<p class="caption">
Figure 5.6: Interesting to see how the ranking changed! Leading the charts is the island of Samoa, followed by Armenia. Countries that remain in the top 10 are Cambodia <code>KH</code>, Philippines <code>PH</code>, Kenya <code>KE</code>, and Tajikstan <code>TJ</code>. Other new countries are Timor-Leste <code>TL</code>, Paraguay <code>PY</code>, Palestine <code>PS</code>, and Lebanon <code>LB</code>.
</p>
</div>
<p>Now let’s look at the distributions of our numeric variables.</p>
<div class="figure"><span id="fig:loan-usd-distribution"></span>
<img src="/post/2018-09-24-spanish-trade-over-time_files/figure-html/loan-usd-distribution-1.png" alt="Half of Kiva loans are 4.22 USD or less. Although the maximum loan is 100,000 USD, 75% of loans are equal to or less than 89.79 USD." width="672" />
<p class="caption">
Figure 5.7: Half of Kiva loans are 4.22 USD or less. Although the maximum loan is 100,000 USD, 75% of loans are equal to or less than 89.79 USD.
</p>
</div>
<div class="figure"><span id="fig:term-in-months-distribution"></span>
<img src="/post/2018-09-24-spanish-trade-over-time_files/figure-html/term-in-months-distribution-1.png" alt="The loan term in months is a bimodal distribution with its first peak around 8 months and its second around 12, the median." width="672" />
<p class="caption">
Figure 5.8: The loan term in months is a bimodal distribution with its first peak around 8 months and its second around 12, the median.
</p>
</div>
<div class="figure"><span id="fig:lender-count"></span>
<img src="/post/2018-09-24-spanish-trade-over-time_files/figure-html/lender-count-1.png" alt="The lender count has a text book right-skewed distribution with a median of 12 lenders." width="672" />
<p class="caption">
Figure 5.9: The lender count has a text book right-skewed distribution with a median of 12 lenders.
</p>
</div>
<div class="figure"><span id="fig:giving-time"></span>
<img src="/post/2018-09-24-spanish-trade-over-time_files/figure-html/giving-time-1.png" alt="The median time between posting the loan and the loan being fully funded is about 9.2 days. It is a bimodal distribution with its first peak around 6 days and its second peak around 30 days." width="672" />
<p class="caption">
Figure 5.10: The median time between posting the loan and the loan being fully funded is about 9.2 days. It is a bimodal distribution with its first peak around 6 days and its second peak around 30 days.
</p>
</div>
<div class="figure"><span id="fig:total-time"></span>
<img src="/post/2018-09-24-spanish-trade-over-time_files/figure-html/total-time-1.png" alt="The total time between posting the loan and it being disbursed has a funky looking multimodal distribution. It seems to be cut off at 30 days with peaks at 7, 14, 21 and 30 days. Median time is 17.2 days." width="672" />
<p class="caption">
Figure 5.11: The total time between posting the loan and it being disbursed has a funky looking multimodal distribution. It seems to be cut off at 30 days with peaks at 7, 14, 21 and 30 days. Median time is 17.2 days.
</p>
</div>
</div>
<div id="techniques-used" class="section level1">
<h1><span class="header-section-number">6</span> Techniques used</h1>
<ul>
<li><p>I used the <code>quantmode</code> package to convert all loans into a unique currency (US dollars) for comparison. There were two currencies that were unavailable.</p></li>
<li><p>Taking all the different levels that came in the <code>borrower_genders</code> variable and creating five neat categories to better understand who are the borrowers was good practice with lists and the <code>stringr</code> package.</p></li>
</ul>
</div>
<div id="questions-from-this-analysis" class="section level1">
<h1><span class="header-section-number">7</span> Questions from this analysis</h1>
<ul>
<li><p>Why is <code>Retail</code> and not <code>Food</code> (as in other regions) the second most common use for loans in Asia.</p></li>
<li><p>Who are the givers? Where are they? Does proximity of the lender to the borrower have anything to do with funding times?</p></li>
<li><p>Does the Kiva website have anything to do with funding times? For example, <code>giving_time</code>, the time between posting the loan and the loan being fully funded, has two peaks, at around one week and one month. Is this due to the platform and the promotion of loans that have been posted for a certain amount of time?</p></li>
</ul>
</div>
