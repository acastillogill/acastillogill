---
title: "Linear regression: R-Downloads around the world"
author: √Ångela Castillo-Gill
date: '2018-12-01'
slug: linear-regression-r-downloads-around-the-world
categories:
  - R
  - Linear regression
tags: 
  - Kaggle
  - Tidy Tuesday
draft: FALSE
summary: "To decide"
header: 
  image: "headers/plot-n-downloads-per-capita-1.png"
  caption: "R Downloads per capita around the world. Iceland and Switzerland are right on top!"
output:
  blogdown::html_page:
    toc: true
    number_sections: true
    toc_depth: 2
  fig_caption: true
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
x <-
  c("dplyr",
    "knitr",
    "here",
    "scales",
    "magrittr",
    "ggplot2",
    "cowplot",
    "tidyverse",
    "Metrics",
    "rsample",
    "broom",
    "sf",
    "rgdal",
    "summarytools",
    "leaflet",
    "tmap",
    "tmaptools",
    "lubridate")


lapply(x, require, character.only = TRUE)


opts_chunk$set(echo = FALSE,
               warning = FALSE,
               error = FALSE,
               message = FALSE,
               collapse = TRUE,
               comment = NA,
               tidy = TRUE,
               include = FALSE)

theme_set(theme_light())

options(
  digits=3,
  scipen = 999
)


knit_hooks$set(inline = function(x) {
  prettyNum(round(x,2), big.mark=",")
})


scale_colour_discrete <- function(...) scale_colour_brewer(..., palette="Paired")
scale_fill_discrete <- function(...) scale_fill_brewer(... , palette="Paired")

r_downloads <- readRDS(file=here::here("static","data","r-downloads.rds"))

r_downloads <- na.omit(r_downloads)%>%
  filter(date<"2018-10-20")

```

# Summary

*To see the code used in this post, visit my [kernel on kaggle in R Markdown format](https://www.kaggle.com/adcastillogill/regression-trees-predicting-property-prices/code).* 

Write up

# Question

What countries download R the most? Where are they? And who are the most *intense* R users measured by R downloads per capita?
Which months of the year are the most popular times to download R? Does it depend on the season? What variable could we attempt to use as a predictor of R downloads? Could we use linear regression for inference?

# Dataset description 

I used the [Tidy Tuesday dataset](https://github.com/rfordatascience/tidytuesday/tree/master/data/2018-10-30) for R Downloads posted on 30th October 2018. 

The dataset contained 938,115 observations and eight features corresponding to a unique id, download date, time, size, version, os, country, and IP id. The downloads correspond to a year's worth of downloads running from 2017-10-20 to 2018-10-20. To prevent any overlap and have one entire year, I limited downloads until 2018-10-19. After I removed missing values, there were `r nrow(r_downloads)` observations.



## Top 10 countries for R Downloads

So what are the top ten countries with the most downloads? 

```{r read-country-codes-and-pop-and-map}
iso_codes <- read_csv(here::here("static","data","iso_countries.csv"))

pop <-read_csv(here::here("static","data","country_populations.csv"))

map_path <- here::here("static","data","world_shapefile","world_shapefile.shp")
world <- sf::st_read(map_path)

```

```{r merge-country-codes}
r_downloads%<>%
  full_join(iso_codes, by=c("country"="iso"))%>%
  filter(!is.na(sub_region))
```

```{r downloads-by-country}
r_downloads%>%
  group_by(name)%>%
  summarise(n=n())%>%
  filter(!is.na(n))%>%
  arrange(desc(n))->downloads_per_country
```

```{r plot-top-10-countries, fig.cap="The US has almost six times as many downloads than the second country China.", include=TRUE}
downloads_per_country%>%
  arrange(desc(n))%>%
  head(10)%>%
  mutate(name=fct_reorder(name,n))%>%
  ggplot(aes(name,n,fill=name))+
  geom_col()+
  expand_limits(y=0)+
  coord_flip()+
  scale_y_continuous(labels=comma_format())+
  labs(title="Top 10 countries by R downloads in 2017/18",
       x="",
       y="Downloads")+
  theme(legend.position = "none")
  
```

```{r create-tibble-with-pop-and-users-only}
full_maps <- downloads_per_country%>%
  full_join(iso_codes, by=c("name"="name"))%>%
  filter(!is.na(sub_region))%>%
  left_join(pop, by=c("name"="name"))%>%
  select(n, name, iso_3, region, sub_region, pop_2018)%>%
  mutate(n_capita=n/pop_2018)%>%
  filter(!is.na(n_capita),
         pop_2018!=0)
```

```{r merge-full-maps-and-map-path}
world_full <- world%>%
  left_join(full_maps, by=c("ISO3"="iso_3"))
```

```{r create-total-downloads-map}
n_map <- tm_shape(world_full) + 
  tm_borders(col="black", lwd=0.1)+
    tm_fill(col="n",n=4, style="jenks", palette = get_brewer_pal("BuPu", n = 4, contrast = c(0.13, 0.9))) + 
tm_layout(main.title = "Total R downloads in 2017/18",
          main.title.size = 2, frame = TRUE, bg.color = "aliceblue", title.position = c("right","bottom"))+
tm_legend(position=c("left", "bottom"), bg.color="white", frame=TRUE, legend.title.size=1)
```
And what about other countries and regions?
```{r plot-total-downloads-map, include=TRUE}
n_map
```


# Linear regression - why use it?

Linear regression is a parametric 

# Results


# What does it mean?

