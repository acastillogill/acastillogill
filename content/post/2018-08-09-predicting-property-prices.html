---
title: Predicting property prices
author: Ángela Castillo-Gill
date: '2018-08-09'
slug: predicting-property-prices
categories:
  - R
  - EDA
tags: 
  - Kaggle
  - Home sales prices
draft: FALSE
summary: What factors most affect sales prices for homes?
output:
  blogdown::html_page:
    toc: true
    number_sections: true
    toc_depth: 2
  fig_caption: true
editor_options: 
  chunk_output_type: console
---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>

<div id="TOC">
<ul>
<li><a href="#summary"><span class="toc-section-number">1</span> Summary</a></li>
<li><a href="#purpose-of-this-post"><span class="toc-section-number">2</span> Purpose of this post</a></li>
<li><a href="#the-data"><span class="toc-section-number">3</span> The data</a><ul>
<li><a href="#missing-values"><span class="toc-section-number">3.1</span> Missing values</a></li>
<li><a href="#variable-creation"><span class="toc-section-number">3.2</span> Variable creation</a></li>
<li><a href="#correlation"><span class="toc-section-number">3.3</span> Correlation</a></li>
<li><a href="#model-with-numeric-variables"><span class="toc-section-number">3.4</span> Model with numeric variables</a></li>
<li><a href="#revaluing-categorical-variables"><span class="toc-section-number">3.5</span> Revaluing categorical variables</a></li>
</ul></li>
<li><a href="#data-exploration"><span class="toc-section-number">4</span> Data exploration</a><ul>
<li><a href="#model-selection"><span class="toc-section-number">4.1</span> Model selection</a></li>
<li><a href="#multi"><span class="toc-section-number">4.2</span> Multi</a></li>
</ul></li>
<li><a href="#techniques-used"><span class="toc-section-number">5</span> Techniques used</a></li>
<li><a href="#questions-from-this-analysis"><span class="toc-section-number">6</span> Questions from this analysis</a></li>
</ul>
</div>

<div id="summary" class="section level1">
<h1><span class="header-section-number">1</span> Summary</h1>
<p><em>To see the code used in this post, visit my <a href="https://www.kaggle.com/adcastillogill/exploring-kiva-loans">kernel on kaggle in R Markdown format</a>.</em></p>
</div>
<div id="purpose-of-this-post" class="section level1">
<h1><span class="header-section-number">2</span> Purpose of this post</h1>
</div>
<div id="the-data" class="section level1">
<h1><span class="header-section-number">3</span> The data</h1>
<p>The dataset <a href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques">House Prices: Advanced Regression Techniques</a> was downloaded from Kaggle and put together by <a href="https://ww2.amstat.org/publications/jse/v19n3/decock.pdf">Dean De Cock.</a> It has 79 explanatory variables describing 1,460 homes in Ames, Iowa. The codebook for all the variables can be <a href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques/data">found here.</a> As I go along, I’ll explain the most relevant ones.</p>
<p>First we will see how many numerical vs. categorical variables there are.</p>
<p>Our dataset has 38 numeric and 43 character variables. Next, since we are interested in estimating sales prices <code>SalePrice</code>, we will recode character variables and see the most strongly correlated variables. There are 43 character variables available. I want to recode them where there is ordinality and where there isn’t dummify them.</p>
<p>There are two numerical variables that are actually date related: <code>YearBuilt</code>and <code>YearRemodAdd</code> (remodelled date). It makes more sense to make two new variables that relate the build and remodelled dates with the present. In other words, I will create the years since built and years since remodelled date variables, this will help interpret the results better.</p>
<div id="missing-values" class="section level2">
<h2><span class="header-section-number">3.1</span> Missing values</h2>
<p>As it more common than not, the dataset contains missing values. Missing values need to be dealt with because regression (and other models) requires complete observations.</p>
<p>Dealing with missing data depends on <em>why the data are missing</em>. <a href="http://www.stat.columbia.edu/~gelman/arm/missing.pdf">This article</a> explains four reasons why data could be missing. When the data are missing at random (MAR) or completely at random (MCAR), observations with missing values can be removed without introducing bias into the model.</p>
<p>Sometimes, however, if the dataset is not too big and we don’t want to lose observations, or even if it is big, yet we still don’t want to remove observations, we can impute data. Imputing means replacing missing values by doing some educated guesses. <a href="https://towardsdatascience.com/how-to-handle-missing-data-8646b18db0d4">This article</a> summarises how to impute data depending on why it is missing.</p>
<p>If the data are not missing at random, then the imputation mechanism has to modelled.</p>
<p>Let’s look at which variables are missing:</p>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:missigness-table">Table 3.1: </span>Variables with missing values in descending order
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Number of NAs
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
PoolQC
</td>
<td style="text-align:right;">
1453
</td>
</tr>
<tr>
<td style="text-align:left;">
MiscFeature
</td>
<td style="text-align:right;">
1406
</td>
</tr>
<tr>
<td style="text-align:left;">
Alley
</td>
<td style="text-align:right;">
1369
</td>
</tr>
<tr>
<td style="text-align:left;">
Fence
</td>
<td style="text-align:right;">
1179
</td>
</tr>
<tr>
<td style="text-align:left;">
FireplaceQu
</td>
<td style="text-align:right;">
690
</td>
</tr>
<tr>
<td style="text-align:left;">
LotFrontage
</td>
<td style="text-align:right;">
259
</td>
</tr>
<tr>
<td style="text-align:left;">
GarageType
</td>
<td style="text-align:right;">
81
</td>
</tr>
<tr>
<td style="text-align:left;">
GarageYrBlt
</td>
<td style="text-align:right;">
81
</td>
</tr>
<tr>
<td style="text-align:left;">
GarageFinish
</td>
<td style="text-align:right;">
81
</td>
</tr>
<tr>
<td style="text-align:left;">
GarageQual
</td>
<td style="text-align:right;">
81
</td>
</tr>
<tr>
<td style="text-align:left;">
GarageCond
</td>
<td style="text-align:right;">
81
</td>
</tr>
<tr>
<td style="text-align:left;">
BsmtExposure
</td>
<td style="text-align:right;">
38
</td>
</tr>
<tr>
<td style="text-align:left;">
BsmtFinType2
</td>
<td style="text-align:right;">
38
</td>
</tr>
<tr>
<td style="text-align:left;">
BsmtQual
</td>
<td style="text-align:right;">
37
</td>
</tr>
<tr>
<td style="text-align:left;">
BsmtCond
</td>
<td style="text-align:right;">
37
</td>
</tr>
<tr>
<td style="text-align:left;">
BsmtFinType1
</td>
<td style="text-align:right;">
37
</td>
</tr>
<tr>
<td style="text-align:left;">
MasVnrType
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
MasVnrArea
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
Electrical
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>19 variables have missing values. Based on the codebook, the reason why so many houses have <code>PoolQC</code> missing is because <code>NA</code>, means there is no pool. Since this variable is ordinal, I can revalue it to make it numerical and <code>0</code> will mean the property has no pool. <code>MiscFeature</code>, <code>Alley</code>, <code>Fence</code>, and <code>FireplaceQu</code> are missing because of similar reasons. We don’t know why <code>LotFrontage</code> is missing but we will impute as the median for properties in the same neighborhood. <a href="https://www.kaggle.com/erikbruin/house-prices-lasso-xgboost-and-a-detailed-eda/code">Erik Bruin’s kernel on Kaggle</a> with this dataset, was a great guideline for what to do in each missing value case.</p>
</div>
<div id="variable-creation" class="section level2">
<h2><span class="header-section-number">3.2</span> Variable creation</h2>
</div>
<div id="correlation" class="section level2">
<h2><span class="header-section-number">3.3</span> Correlation</h2>
<p>Correlation, <span class="math inline">\(Cor(X,Y)\)</span>, measures the strength of the linear relationship between two variables <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p>
<p>If I were just to create a model with numeric variables, let’s see which ones are significant.</p>
<p><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/correlation_matrix-1.png" width="672" /></p>
</div>
<div id="model-with-numeric-variables" class="section level2">
<h2><span class="header-section-number">3.4</span> Model with numeric variables</h2>
</div>
<div id="revaluing-categorical-variables" class="section level2">
<h2><span class="header-section-number">3.5</span> Revaluing categorical variables</h2>
</div>
</div>
<div id="data-exploration" class="section level1">
<h1><span class="header-section-number">4</span> Data exploration</h1>
<div id="model-selection" class="section level2">
<h2><span class="header-section-number">4.1</span> Model selection</h2>
</div>
<div id="multi" class="section level2">
<h2><span class="header-section-number">4.2</span> Multi</h2>
<p>We will check that there is no multicolinearity amongst highly correlated variables. <em>explain here what is multicolinearity</em>.</p>
<p>After removing predictors that were related amongst themselves, the top 13 variables most (above 0.5) correlated with <code>SalesPrice</code> were:</p>
<p><strong>Positive correlation</strong></p>
<ul>
<li><code>OverallQual</code>: Rates the overall material and finish of the house</li>
<li><code>ExterQual</code>: Exterior quality</li>
<li><code>KitchenQual</code>: Kitchen quality</li>
<li><code>GarageArea</code>: Size of garage in square feet</li>
<li><code>X1stFlrSF</code>: First floor square feet</li>
<li><code>BsmtQual</code>: Height of basement</li>
<li><code>FullBath</code>: Full bathrooms above grade</li>
<li><code>GarageFinish</code>: Interior finish of the garage</li>
<li><code>TotRmsAbvGrd</code>: Total rooms above grade (does not include bathrooms)</li>
<li><code>FireplaceQu</code>: Fireplace quality</li>
</ul>
<p><strong>Negative correlation</strong></p>
<ul>
<li><code>YearsSinceRemod</code>: Years since remodel date (same as construction date if no remodelling or additions)</li>
<li><code>YearsSinceGarageBuilt</code>: Years since the garage was built</li>
<li><code>YearsSinceBuilt</code>: Years since construction date</li>
</ul>
<p><strong>Numeric variables</strong></p>
<p><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-1.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-2.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-3.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-4.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-5.png" width="672" /></p>
<p><strong>Categorical variables</strong></p>
<p><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/plotting%20categorical%20variables-1.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/plotting%20categorical%20variables-2.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/plotting%20categorical%20variables-3.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/plotting%20categorical%20variables-4.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/plotting%20categorical%20variables-5.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/plotting%20categorical%20variables-6.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/plotting%20categorical%20variables-7.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/plotting%20categorical%20variables-8.png" width="672" /></p>
</div>
</div>
<div id="techniques-used" class="section level1">
<h1><span class="header-section-number">5</span> Techniques used</h1>
<ul>
<li>I</li>
</ul>
</div>
<div id="questions-from-this-analysis" class="section level1">
<h1><span class="header-section-number">6</span> Questions from this analysis</h1>
<ul>
<li></li>
</ul>
</div>
