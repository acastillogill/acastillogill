---
title: Predicting property prices
author: Ángela Castillo-Gill
date: '2018-08-09'
slug: predicting-property-prices
categories:
  - R
  - EDA
tags: 
  - Kaggle
  - Home sales prices
draft: FALSE
summary: What factors most affect sales prices for homes?
output:
  blogdown::html_page:
    toc: true
    number_sections: true
    toc_depth: 2
  fig_caption: true
editor_options: 
  chunk_output_type: inline
---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>

<div id="TOC">
<ul>
<li><a href="#summary"><span class="toc-section-number">1</span> Summary</a></li>
<li><a href="#purpose-of-this-post"><span class="toc-section-number">2</span> Purpose of this post</a></li>
<li><a href="#the-data"><span class="toc-section-number">3</span> The data</a></li>
<li><a href="#data-exploration"><span class="toc-section-number">4</span> Data exploration</a></li>
<li><a href="#techniques-used"><span class="toc-section-number">5</span> Techniques used</a></li>
</ul>
</div>

<div id="summary" class="section level1">
<h1><span class="header-section-number">1</span> Summary</h1>
<p><em>To see the code used in this post, visit my <a href="https://www.kaggle.com/adcastillogill/exploring-kiva-loans">kernel on kaggle in R Markdown format</a>.</em></p>
</div>
<div id="purpose-of-this-post" class="section level1">
<h1><span class="header-section-number">2</span> Purpose of this post</h1>
</div>
<div id="the-data" class="section level1">
<h1><span class="header-section-number">3</span> The data</h1>
<p>The dataset <a href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques">House Prices: Advanced Regression Techniques</a> was downloaded from Kaggle and put together by <a href="https://ww2.amstat.org/publications/jse/v19n3/decock.pdf">Dean De Cock.</a> It has 79 explanatory variables describing 1,460 homes in Ames, Iowa. The codebook for all the variables can be <a href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques/data">found here.</a> As I go along, I’ll explain the most releveant ones.</p>
<p>First we will see how many numerical vs. categorical variables there are.</p>
<pre><code>[1] 38
[1] 43</code></pre>
<p>Our dataset has 38 numeric and 43 categorical variables. Next, since we are interested in estimating sales prices <code>SalePrice</code>, we will recode categorical variables and see the most strongly correlated variables. There are 43 categorical variables available. I want to recode them, that is to make dummy variables (1 has that factor level, 0 doesn’t) to see a correlation table with the most correlated variables to <code>SalesPrice</code>.</p>
<p>There are two numerical variables that are actually date related: <code>YearBuilt</code>and <code>YearRemodAdd</code> (remodelled date). It makes more sense to make two new variables that relate the build and remodelled dates with the present. In other words, I will create the years since built and years since remodelled date variables, this will help interpret the results better.</p>
<pre><code>Observations: 1,460
Variables: 81
$ Id              &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,...
$ MSSubClass      &lt;int&gt; 60, 20, 60, 70, 60, 50, 20, 60, 50, 190, 20, 6...
$ MSZoning        &lt;fct&gt; RL, RL, RL, RL, RL, RL, RL, RL, RM, RL, RL, RL...
$ LotFrontage     &lt;int&gt; 65, 80, 68, 60, 84, 85, 75, NA, 51, 50, 70, 85...
$ LotArea         &lt;int&gt; 8450, 9600, 11250, 9550, 14260, 14115, 10084, ...
$ Street          &lt;fct&gt; Pave, Pave, Pave, Pave, Pave, Pave, Pave, Pave...
$ Alley           &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
$ LotShape        &lt;fct&gt; Reg, Reg, IR1, IR1, IR1, IR1, Reg, IR1, Reg, R...
$ LandContour     &lt;fct&gt; Lvl, Lvl, Lvl, Lvl, Lvl, Lvl, Lvl, Lvl, Lvl, L...
$ Utilities       &lt;fct&gt; AllPub, AllPub, AllPub, AllPub, AllPub, AllPub...
$ LotConfig       &lt;fct&gt; Inside, FR2, Inside, Corner, FR2, Inside, Insi...
$ LandSlope       &lt;fct&gt; Gtl, Gtl, Gtl, Gtl, Gtl, Gtl, Gtl, Gtl, Gtl, G...
$ Neighborhood    &lt;fct&gt; CollgCr, Veenker, CollgCr, Crawfor, NoRidge, M...
$ Condition1      &lt;fct&gt; Norm, Feedr, Norm, Norm, Norm, Norm, Norm, Pos...
$ Condition2      &lt;fct&gt; Norm, Norm, Norm, Norm, Norm, Norm, Norm, Norm...
$ BldgType        &lt;fct&gt; 1Fam, 1Fam, 1Fam, 1Fam, 1Fam, 1Fam, 1Fam, 1Fam...
$ HouseStyle      &lt;fct&gt; 2Story, 1Story, 2Story, 2Story, 2Story, 1.5Fin...
$ OverallQual     &lt;int&gt; 7, 6, 7, 7, 8, 5, 8, 7, 7, 5, 5, 9, 5, 7, 6, 7...
$ OverallCond     &lt;int&gt; 5, 8, 5, 5, 5, 5, 5, 6, 5, 6, 5, 5, 6, 5, 5, 8...
$ RoofStyle       &lt;fct&gt; Gable, Gable, Gable, Gable, Gable, Gable, Gabl...
$ RoofMatl        &lt;fct&gt; CompShg, CompShg, CompShg, CompShg, CompShg, C...
$ Exterior1st     &lt;fct&gt; VinylSd, MetalSd, VinylSd, Wd Sdng, VinylSd, V...
$ Exterior2nd     &lt;fct&gt; VinylSd, MetalSd, VinylSd, Wd Shng, VinylSd, V...
$ MasVnrType      &lt;fct&gt; BrkFace, None, BrkFace, None, BrkFace, None, S...
$ MasVnrArea      &lt;int&gt; 196, 0, 162, 0, 350, 0, 186, 240, 0, 0, 0, 286...
$ ExterQual       &lt;fct&gt; Gd, TA, Gd, TA, Gd, TA, Gd, TA, TA, TA, TA, Ex...
$ ExterCond       &lt;fct&gt; TA, TA, TA, TA, TA, TA, TA, TA, TA, TA, TA, TA...
$ Foundation      &lt;fct&gt; PConc, CBlock, PConc, BrkTil, PConc, Wood, PCo...
$ BsmtQual        &lt;fct&gt; Gd, Gd, Gd, TA, Gd, Gd, Ex, Gd, TA, TA, TA, Ex...
$ BsmtCond        &lt;fct&gt; TA, TA, TA, Gd, TA, TA, TA, TA, TA, TA, TA, TA...
$ BsmtExposure    &lt;fct&gt; No, Gd, Mn, No, Av, No, Av, Mn, No, No, No, No...
$ BsmtFinType1    &lt;fct&gt; GLQ, ALQ, GLQ, ALQ, GLQ, GLQ, GLQ, ALQ, Unf, G...
$ BsmtFinSF1      &lt;int&gt; 706, 978, 486, 216, 655, 732, 1369, 859, 0, 85...
$ BsmtFinType2    &lt;fct&gt; Unf, Unf, Unf, Unf, Unf, Unf, Unf, BLQ, Unf, U...
$ BsmtFinSF2      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 32, 0, 0, 0, 0, 0, 0, 0, ...
$ BsmtUnfSF       &lt;int&gt; 150, 284, 434, 540, 490, 64, 317, 216, 952, 14...
$ TotalBsmtSF     &lt;int&gt; 856, 1262, 920, 756, 1145, 796, 1686, 1107, 95...
$ Heating         &lt;fct&gt; GasA, GasA, GasA, GasA, GasA, GasA, GasA, GasA...
$ HeatingQC       &lt;fct&gt; Ex, Ex, Ex, Gd, Ex, Ex, Ex, Ex, Gd, Ex, Ex, Ex...
$ CentralAir      &lt;fct&gt; Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y...
$ Electrical      &lt;fct&gt; SBrkr, SBrkr, SBrkr, SBrkr, SBrkr, SBrkr, SBrk...
$ X1stFlrSF       &lt;int&gt; 856, 1262, 920, 961, 1145, 796, 1694, 1107, 10...
$ X2ndFlrSF       &lt;int&gt; 854, 0, 866, 756, 1053, 566, 0, 983, 752, 0, 0...
$ LowQualFinSF    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
$ GrLivArea       &lt;int&gt; 1710, 1262, 1786, 1717, 2198, 1362, 1694, 2090...
$ BsmtFullBath    &lt;int&gt; 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0...
$ BsmtHalfBath    &lt;int&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
$ FullBath        &lt;int&gt; 2, 2, 2, 1, 2, 1, 2, 2, 2, 1, 1, 3, 1, 2, 1, 1...
$ HalfBath        &lt;int&gt; 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0...
$ BedroomAbvGr    &lt;int&gt; 3, 3, 3, 3, 4, 1, 3, 3, 2, 2, 3, 4, 2, 3, 2, 2...
$ KitchenAbvGr    &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1...
$ KitchenQual     &lt;fct&gt; Gd, TA, Gd, Gd, Gd, TA, Gd, TA, TA, TA, TA, Ex...
$ TotRmsAbvGrd    &lt;int&gt; 8, 6, 6, 7, 9, 5, 7, 7, 8, 5, 5, 11, 4, 7, 5, ...
$ Functional      &lt;fct&gt; Typ, Typ, Typ, Typ, Typ, Typ, Typ, Typ, Min1, ...
$ Fireplaces      &lt;int&gt; 0, 1, 1, 1, 1, 0, 1, 2, 2, 2, 0, 2, 0, 1, 1, 0...
$ FireplaceQu     &lt;fct&gt; NA, TA, TA, Gd, TA, NA, Gd, TA, TA, TA, NA, Gd...
$ GarageType      &lt;fct&gt; Attchd, Attchd, Attchd, Detchd, Attchd, Attchd...
$ GarageYrBlt     &lt;int&gt; 2003, 1976, 2001, 1998, 2000, 1993, 2004, 1973...
$ GarageFinish    &lt;fct&gt; RFn, RFn, RFn, Unf, RFn, Unf, RFn, RFn, Unf, R...
$ GarageCars      &lt;int&gt; 2, 2, 2, 3, 3, 2, 2, 2, 2, 1, 1, 3, 1, 3, 1, 2...
$ GarageArea      &lt;int&gt; 548, 460, 608, 642, 836, 480, 636, 484, 468, 2...
$ GarageQual      &lt;fct&gt; TA, TA, TA, TA, TA, TA, TA, TA, Fa, Gd, TA, TA...
$ GarageCond      &lt;fct&gt; TA, TA, TA, TA, TA, TA, TA, TA, TA, TA, TA, TA...
$ PavedDrive      &lt;fct&gt; Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y...
$ WoodDeckSF      &lt;int&gt; 0, 298, 0, 0, 192, 40, 255, 235, 90, 0, 0, 147...
$ OpenPorchSF     &lt;int&gt; 61, 0, 42, 35, 84, 30, 57, 204, 0, 4, 0, 21, 0...
$ EnclosedPorch   &lt;int&gt; 0, 0, 0, 272, 0, 0, 0, 228, 205, 0, 0, 0, 0, 0...
$ X3SsnPorch      &lt;int&gt; 0, 0, 0, 0, 0, 320, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
$ ScreenPorch     &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 176, 0, 0,...
$ PoolArea        &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
$ PoolQC          &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
$ Fence           &lt;fct&gt; NA, NA, NA, NA, NA, MnPrv, NA, NA, NA, NA, NA,...
$ MiscFeature     &lt;fct&gt; NA, NA, NA, NA, NA, Shed, NA, Shed, NA, NA, NA...
$ MiscVal         &lt;int&gt; 0, 0, 0, 0, 0, 700, 0, 350, 0, 0, 0, 0, 0, 0, ...
$ MoSold          &lt;int&gt; 2, 5, 9, 2, 12, 10, 8, 11, 4, 1, 2, 7, 9, 8, 5...
$ YrSold          &lt;int&gt; 2008, 2007, 2008, 2006, 2008, 2009, 2007, 2009...
$ SaleType        &lt;fct&gt; WD, WD, WD, WD, WD, WD, WD, WD, WD, WD, WD, Ne...
$ SaleCondition   &lt;fct&gt; Normal, Normal, Normal, Abnorml, Normal, Norma...
$ SalePrice       &lt;int&gt; 208500, 181500, 223500, 140000, 250000, 143000...
$ YearsSinceBuilt &lt;dbl&gt; 15, 42, 17, 103, 18, 25, 14, 45, 87, 79, 53, 1...
$ YearsSinceRemod &lt;dbl&gt; 15, 42, 16, 48, 18, 23, 13, 45, 68, 68, 53, 12...</code></pre>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-6">Table 3.1: </span>Top 14 correlations with SalePrice
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Correlation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
OverallQual
</td>
<td style="text-align:right;">
0.7909816
</td>
</tr>
<tr>
<td style="text-align:left;">
GrLivArea
</td>
<td style="text-align:right;">
0.7086245
</td>
</tr>
<tr>
<td style="text-align:left;">
GarageCars
</td>
<td style="text-align:right;">
0.6404092
</td>
</tr>
<tr>
<td style="text-align:left;">
GarageArea
</td>
<td style="text-align:right;">
0.6234314
</td>
</tr>
<tr>
<td style="text-align:left;">
TotalBsmtSF
</td>
<td style="text-align:right;">
0.6135806
</td>
</tr>
<tr>
<td style="text-align:left;">
X1stFlrSF
</td>
<td style="text-align:right;">
0.6058522
</td>
</tr>
<tr>
<td style="text-align:left;">
FullBath
</td>
<td style="text-align:right;">
0.5606638
</td>
</tr>
<tr>
<td style="text-align:left;">
BsmtQualEx
</td>
<td style="text-align:right;">
0.5531048
</td>
</tr>
<tr>
<td style="text-align:left;">
TotRmsAbvGrd
</td>
<td style="text-align:right;">
0.5337232
</td>
</tr>
<tr>
<td style="text-align:left;">
KitchenQualEx
</td>
<td style="text-align:right;">
0.5040937
</td>
</tr>
<tr>
<td style="text-align:left;">
YearsSinceRemod
</td>
<td style="text-align:right;">
-0.5071010
</td>
</tr>
<tr>
<td style="text-align:left;">
KitchenQualTA
</td>
<td style="text-align:right;">
-0.5192979
</td>
</tr>
<tr>
<td style="text-align:left;">
YearsSinceBuilt
</td>
<td style="text-align:right;">
-0.5228973
</td>
</tr>
<tr>
<td style="text-align:left;">
ExterQualTA
</td>
<td style="text-align:right;">
-0.5890435
</td>
</tr>
</tbody>
</table>
</div>
<div id="data-exploration" class="section level1">
<h1><span class="header-section-number">4</span> Data exploration</h1>
<p>First we will check that there is no multicolinearity amongst highly correlated variables. <em>explain here what is multicolinearity</em>.</p>
<pre><code>    OverallQual       GrLivArea      GarageCars      GarageArea 
       3.188492        5.084395        5.259511        4.953950 
    TotalBsmtSF       X1stFlrSF        FullBath      BsmtQualEx 
       3.635031        3.730712        2.265751        1.592110 
   TotRmsAbvGrd YearsSinceBuilt YearsSinceRemod   KitchenQualEx 
       3.427834        2.463106        1.983189        1.513045 
  KitchenQualTA     ExterQualTA 
       2.107762        2.524197 </code></pre>
<p>We can see that the variables related to garage show some signs of multicolinearity so I will take out <code>GarageCars</code>.</p>
<pre><code>    OverallQual       GrLivArea      GarageArea     TotalBsmtSF 
       3.135769        5.072554        1.773379        3.614166 
      X1stFlrSF        FullBath      BsmtQualEx    TotRmsAbvGrd 
       3.729697        2.250221        1.592101        3.402346 
YearsSinceBuilt YearsSinceRemod   KitchenQualEx   KitchenQualTA 
       2.410529        1.982792        1.511303        2.107737 
    ExterQualTA 
       2.523620 </code></pre>
<p>After removing predictors that were related amongst themselves, the top 13 variables most (above 0.5) correlated are:</p>
<p><strong>Positive correlation</strong></p>
<ul>
<li><code>OverallQual</code>: Rates the overall material and finish of the house</li>
<li><code>GarageArea</code>: Size of garage in square feet</li>
<li><code>TotalBsmtSF</code>: Total square feet of basement area</li>
<li><code>X1stFlrSF</code>: First Floor square feet</li>
<li><code>FullBath</code>: Full bathrooms above grade</li>
<li><code>BsmtQualEx</code>: Height of basement 100+ inches</li>
<li><code>TotRmsAbvGrd</code>: Total rooms above grade (does not include bathrooms)</li>
<li><code>KitchenQualEx</code>: Excellent kitchen quality</li>
</ul>
<p><strong>Negative correlation</strong></p>
<ul>
<li><code>YearsSinceRemod</code>: Years since remodel date (same as construction date if no remodelling or additions)
_ <code>KitchenQualTA</code>: Typical/Average kitchen quality</li>
<li><code>YearsSinceBuilt</code>: Years since construction date</li>
<li><code>ExterQualTA</code>: Typical/Average quality of the material on the exterior</li>
</ul>
<p>We will inspect scatter plots against the response variable <code>SalePrice</code>.</p>
<p><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-1.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-2.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-3.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-4.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-5.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-6.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-7.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-8.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-9.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-10.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-11.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/high-cor-geompoint-12.png" width="672" /></p>
<p>Some numeric variables can actually be better interpreted as factors, these are: <code>OverallQual</code>, <code>FullBath</code>, <code>TotRmsAbvGrd</code>, <code>BsmtQualEx</code>, <code>KitchenQualEx</code>, <code>KitchenQualTA</code>, and <code>ExterQualTA</code>.</p>
<p><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/unnamed-chunk-10-1.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/unnamed-chunk-10-2.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/unnamed-chunk-10-3.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/unnamed-chunk-10-4.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/unnamed-chunk-10-5.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/unnamed-chunk-10-6.png" width="672" /><img src="/post/2018-08-09-predicting-property-prices_files/figure-html/unnamed-chunk-10-7.png" width="672" /></p>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-11">Table 4.1: </span>Top 12 correlations with SalePrice
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Correlation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
OverallQual
</td>
<td style="text-align:right;">
0.7909816
</td>
</tr>
<tr>
<td style="text-align:left;">
GarageCars
</td>
<td style="text-align:right;">
0.6404092
</td>
</tr>
<tr>
<td style="text-align:left;">
GarageArea
</td>
<td style="text-align:right;">
0.6234314
</td>
</tr>
<tr>
<td style="text-align:left;">
TotalBsmtSF
</td>
<td style="text-align:right;">
0.6135806
</td>
</tr>
<tr>
<td style="text-align:left;">
X1stFlrSF
</td>
<td style="text-align:right;">
0.6058522
</td>
</tr>
<tr>
<td style="text-align:left;">
FullBath
</td>
<td style="text-align:right;">
0.5606638
</td>
</tr>
<tr>
<td style="text-align:left;">
BsmtQualEx
</td>
<td style="text-align:right;">
0.5531048
</td>
</tr>
<tr>
<td style="text-align:left;">
TotRmsAbvGrd
</td>
<td style="text-align:right;">
0.5337232
</td>
</tr>
<tr>
<td style="text-align:left;">
KitchenQualEx
</td>
<td style="text-align:right;">
0.5040937
</td>
</tr>
<tr>
<td style="text-align:left;">
YearsSinceRemod
</td>
<td style="text-align:right;">
-0.5071010
</td>
</tr>
<tr>
<td style="text-align:left;">
KitchenQualTA
</td>
<td style="text-align:right;">
-0.5192979
</td>
</tr>
<tr>
<td style="text-align:left;">
YearsSinceBuilt
</td>
<td style="text-align:right;">
-0.5228973
</td>
</tr>
<tr>
<td style="text-align:left;">
ExterQualTA
</td>
<td style="text-align:right;">
-0.5890435
</td>
</tr>
</tbody>
</table>
</div>
<div id="techniques-used" class="section level1">
<h1><span class="header-section-number">5</span> Techniques used</h1>
<ul>
<li><p>I
# Questions from this analysis</p></li>
<li></li>
</ul>
</div>
