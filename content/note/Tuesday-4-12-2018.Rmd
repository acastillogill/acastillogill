---
title: "Adding variables"
subtitle: "This will be fun, as I search for variables, I'll add them to the regression to the see the adjusted effects."
author: √Ångela Castillo-Gill
date: '2018-12-04'
slug: adding-variables
categories:
  - Journal
tags: 
  - Learning
draft: FALSE
summary: "This will be fun, as I search for variables, I'll add them to the regression to the see the adjusted effects."
output:
 blogdown::html_page:
  fig_caption: true
editor_options: 
  chunk_output_type: console
---

```{r setup, echo=FALSE, message=FALSE}
library(tidyverse)
library(rpart)
library(rpart.plot)
library(knitr)
library(here)
library(scales)
library(magrittr)
options(digits=4)
options(scipen = 999)
opts_chunk$set(echo = TRUE,
               warning = FALSE,
               error = FALSE,
               message = FALSE,
               collapse= TRUE,
               comment = NA,
               tidy = TRUE)
theme_set(theme_light())
r_downloads <- readRDS(file=here::here("static","data","r-downloads.rds"))
```

As a follow up to Friday's post on the new packages and scripts I would like to make. I can report that I have learned the `here` package and was able to make a `makefile` too to organise all my projects. I have a good understanding now, I think. I'll leave `testthat` for this Friday and `roxygen2` for another rainy day. 

It's important to invest that time in learning things that will make my workflow more efficient. At first it feels like I'm stalling or something, but it can be worth the investment in the future. 

Now, in a previous I had said that I wanted to find another dataset, but then I decided to keep the property price dataset, but now I don't think I can be bothered. 

I will look at datasets on Tidy Tuesday and find something that excites me from there. I think the most important thing to keep me going is, does the dataset make me curious about something. I found a dataset on a year's worth of R Language downloads.

My questions here that could lead to a regression of some sort are, which countries download R Language the most in a year. What is the relationship with GPD per capita, with education funding, maybe even GINI index. 

I would be working backwards, the downloads would be my $Y$ variable and then I would have to find statistics from around the internet. Could be fun and also, I wouldn't be so overwhelmed about a lot of variables at once. I have the option to find each one. 

Let's read the data in and explore it:

```{r read-data, eval=FALSE}
r_downloads <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2018-10-30/r_downloads_year.csv")
```

Let's save that data for a rainy day since it took a while to download:

```{r save-data-for-later, eval=FALSE}
saveRDS(r_downloads, here("static","data","r-downloads.rds"))
```

Excellent!

[Data source](https://github.com/rfordatascience/tidytuesday/tree/master/data/2018-10-30)

```{r downloads-by-country}
r_downloads%>%
  #Count and arrange downloads per country
  count(country,sort = TRUE)%>%
  ungroup()->downloads_per_country
```

Now I'm going to give the countries full names, to do this I will use the ISO code to merge and obtain names. 

```{r read-country-codes}
iso_codes <- read_csv(here("static","data","iso_countries.csv"))
```

```{r merge-country-codes}
downloads_per_country%<>%
  right_join(iso_codes, by=c("country"="iso"))
```


## Which are the top ten countries in terms of downloads
```{r top-20-countries-plot}
downloads_per_country%>%
  arrange(desc(n))%>%
  filter(!is.na(name))%>%
  head(20)%>%
  mutate(name=fct_reorder(name,n))%>%
  ggplot(aes(name,n,fill=name))+
  geom_col()+
  expand_limits(y=0)+
  coord_flip()+
  scale_y_continuous(labels=comma_format())+
  labs(title="Top 20 countries by R downloads",
       x="Country",
       y="Downloads")+
  theme(legend.position = "none")
  
```

```{r read-internet-users}
internet_users <-read_csv(here("static","data","internet_users.csv"))
```

```{r merge-internet-users}
downloads_per_country%<>%
  right_join(internet_users, by=c("name"="name"))
```

```{r downloads-internet-users-scatter-plot}
library(plotly)
library(ggrepel)
downloads_internet_plot<- downloads_per_country%>%
  arrange(desc(n))%>%
  head(100)%>%
  ggplot(aes(users, n, label=name, color=region))+
  geom_jitter(alpha=0.3)+ scale_x_continuous(labels=comma_format())+
scale_y_continuous(labels=comma_format())+
  geom_smooth(aes(group=1),method="lm")+
  labs(title="Do R-Language downloads increase with more internet users?",
       y="Downloads per country",
       x="Internet users in each country")+ theme(legend.position = "bottom")
  

ggplotly(downloads_internet_plot)
```

