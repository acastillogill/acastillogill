---
title: "Applying concepts learned to property prices"
subtitle: "and also, rpart plots and the problem with so many factors."
author: Ángela Castillo-Gill
date: '2018-11-13'
slug: applying-concepts-learned-to-property-prices
categories:
  - Journal
tags: 
  - Learning
draft: FALSE
summary: "and also, rpart plots and the problem with so many factors."
output:
 blogdown::html_page
---



<div id="goals-for-todays-session-are" class="section level1">
<h1>Goal’s for today’s session are:</h1>
<ol style="list-style-type: decimal">
<li><p>Interpret the <code>cptable</code> for the generic <code>homes_model</code>.</p></li>
<li><p>Interpret the <code>rpart.plot</code> associated to <code>homes_model</code>.</p></li>
<li><p>Bin the <code>neighborhood</code> variable and explain why I’m doing that.</p></li>
</ol>
<div id="goal-1-interpret-the-cptable-for-the-generic-homes_model." class="section level2">
<h2>Goal 1: Interpret the <code>cptable</code> for the generic <code>homes_model</code>.</h2>
<p>With the <code>homes</code> data as is (just removing missing values), I fited a model to predict <code>SalesPrice</code> using <code>rpart()</code>:</p>
<pre class="r"><code>homes_model &lt;- rpart(formula = SalePrice ~ ., 
                     data = homes_train, 
                     method = &quot;anova&quot;)</code></pre>
<p>Looking at the <code>cptable</code> with <code>homes_model$cptable</code>, I’ll apply the <span class="math inline">\(1-SE\)</span> rule I explained yesterday:</p>
<p><img src="/note/Tues-13-11-2018_files/cptable_rawhomes.png" /></p>
<p>First, we can see that the smallest cross-validation <code>xerror</code> appears on row 11. Now let’s add 1 standard error <code>xstd</code>: <span class="math inline">\(0.3074050+0.03541012=0.3428151\)</span>.</p>
<p>The smallest tree with <code>xerror</code> less than <span class="math inline">\(0.3428151\)</span> is the tree appearing on row 8 with 8 splits and 9 nodes.</p>
<p>Now, I look at the <code>plotcp(homes_model)</code>, I’m confused to whether size of the tree refers to nodes or splits:</p>
<p><img src="/note/Tues-13-11-2018_files/cpplot_rawhomes.png" /></p>
<p>I think it refers to nodes because the <code>xerror</code> for the tree with 9 nodes appears on the dotted line. A dotted line that intersects the 9-tree node must mean it’s the chosen one, right? :laughing:</p>
<p>Now, let’s run the model again, but specifying the best model, with 8 splits.</p>
<pre class="r"><code># Hard code best tree based on above explained analysis
opt_index &lt;- 8
#Retrieve cp_opt
cp_opt &lt;- homes_model$cptable[opt_index, &quot;CP&quot;]
# Prune the model (to optimized cp value)
homes_model_opt &lt;- prune(tree = homes_model, 
                         cp = cp_opt)</code></pre>
<p>I suppose hard coding the number 8 instead of writing the code to pick the best tree isn’t too elegant, but bear with me. Writing clean code is not the priority right now. :hankey:</p>
</div>
<div id="goal-2-interpret-the-rpart.plot-associated-to-homes_model." class="section level2">
<h2>Goal 2: Interpret the <code>rpart.plot</code> associated to <code>homes_model</code>.</h2>
<pre class="r"><code>rpart.plot(x = homes_model_opt, type = 5, extra = 1)</code></pre>
<p>That code produces this plot:</p>
<p><img src="/note/Tues-13-11-2018_files/rpartplot_rawhomes.png" /></p>
<p>It has 8 splits and 9 nodes and we asked it to. Inside each terminal node is the number of observations which add up to 1025. Each split specifies the criteria for the observation being classified either into the left or right son.</p>
<p>If we go back and look at the numeric variables that had the highest correlation with <code>SalesPrice</code>, <code>OverallQual</code> was leading followed by <code>GrLivArea</code>. In the tree we can see that these variables appear further below <code>X1stFlrSF</code> and <code>GarageArea</code> appear later down.</p>
<p>The plot shows the <code>neighborhood</code> variable twice and in the second level. So it’s an important variable.</p>
</div>
<div id="goal-3-bin-the-neighborhood-variable-and-explain-why-im-doing-that." class="section level2">
<h2>Goal 3: Bin the <code>neighborhood</code> variable and explain why I’m doing that.</h2>
<p>So today I don’t think I’ll be able to the binning since my alloted time for this is almost up. But I will explain the why since it appears clearly on the graph.</p>
<p>One of the advantages of regression trees is that they area easy to understand and visualise. Because the <code>neighborhood</code> variable has so many levels, it is actually going against one of the reasons I picked it. The whole neighborhood variable is confusing. Explaining the key differences amongst neighborhoods is not straightforward using just the plot. So I’m going to explore what the relationship between those neighborhoods and price is tomorrow and see if I can create another variable that better reflects that relationship. Exciting! :sparkles:</p>
</div>
</div>
